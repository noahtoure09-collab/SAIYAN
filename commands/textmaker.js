import mumaker from 'mumaker';

const TEXT_TYPES = {
  metallic: "https://en.ephoto360.com/impressive-decorative-3d-metal-text-effect-798.html",
  ice: "https://en.ephoto360.com/ice-text-effect-online-101.html",
  snow: "https://en.ephoto360.com/create-a-snow-3d-text-effect-free-online-621.html",
  impressive: "https://en.ephoto360.com/create-3d-colorful-paint-text-effect-online-801.html",
  matrix: "https://en.ephoto360.com/matrix-text-effect-154.html",
  light: "https://en.ephoto360.com/light-text-effect-futuristic-technology-style-648.html",
  neon: "https://en.ephoto360.com/create-colorful-neon-light-text-effects-online-797.html",
  devil: "https://en.ephoto360.com/neon-devil-wings-text-effect-online-683.html",
  purple: "https://en.ephoto360.com/purple-text-effect-online-100.html",
  thunder: "https://en.ephoto360.com/thunder-text-effect-online-97.html",
  leaves: "https://en.ephoto360.com/green-brush-text-effect-typography-maker-online-153.html",
  arena: "https://en.ephoto360.com/create-cover-arena-of-valor-by-mastering-360.html",
  hacker: "https://en.ephoto360.com/create-anonymous-hacker-avatars-cyan-neon-677.html",
  sand: "https://en.ephoto360.com/write-names-and-messages-on-the-sand-online-582.html",
  blackpink: "https://en.ephoto360.com/create-a-blackpink-style-logo-with-members-signatures-810.html",
  glitch: "https://en.ephoto360.com/create-digital-glitch-text-effects-online-767.html",
  fire: "https://en.ephoto360.com/flame-lettering-effect-372.html",
  '1917': "https://en.ephoto360.com/1917-style-text-effect-523.html"
};

const formatTypes = () =>
  Object.keys(TEXT_TYPES).map(t => `â€¢ ${t}`).join('\n');

export default {
  name: 'textmaker',
  alias: ['textgen', 'ephoto', 'tm'],
  category: 'Image',
  description: 'Generates stylish text with different ePhoto360 effects',

  async execute(kaya, m, args) {
    const chatId = m.chat;

    // ğŸ§  Normalize arguments
    const type = args[0]?.toLowerCase();
    const text = args.slice(1).join(' ').trim();

    // âŒ Incorrect usage
    if (!type || !TEXT_TYPES[type]) {
      return kaya.sendMessage(chatId, {
        text:
`âŒ *Incorrect usage of TextMaker*

ğŸ“Œ *Usage*:
.textmaker <type> <text>

ğŸ¨ *Available types*:
${formatTypes()}

âœ¨ *Example*:
.textmaker metallic Saiyan`
      }, { quoted: m });
    }

    // âŒ Missing text
    if (!text) {
      return kaya.sendMessage(chatId, {
        text:
`âŒ *Missing text*

ğŸ“Œ Example:
.textmaker ${type} Saiyan`
      }, { quoted: m });
    }

    try {
      const result = await mumaker.ephoto(TEXT_TYPES[type], text);

      if (!result?.image) throw new Error('Image not generated');

      await kaya.sendMessage(chatId, {
        image: { url: result.image },
        caption: 'âœ¨ *GENERATED BY SAIYANS* âœ¨'
      }, { quoted: m });

    } catch (err) {
      console.error('âŒ textmaker error:', err);
      await kaya.sendMessage(chatId, {
        text: `âŒ Unable to generate image.\nError: ${err.message}`
      }, { quoted: m });
    }
  }
};